(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{619:function(s,t,n){"use strict";n.r(t);var a=n(15),e=Object(a.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"菜单阴影"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#菜单阴影"}},[s._v("#")]),s._v(" 菜单阴影")]),s._v(" "),n("p",[s._v("Qt自带的菜单太单调了，要自己定制，所以简单修改了Qss")]),s._v(" "),n("div",{staticClass:"language-css line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-css"}},[n("code",[s._v("QString qss = "),n("span",{pre:!0,attrs:{class:"token selector"}},[s._v('"QMenu')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\\\n     "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v("background-color")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rgb")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("255"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("255"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("255"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\\\n     "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v("padding")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 5px"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\\\n     "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v("margin")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 5px"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\\\n     "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v("border")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 1px solid gray"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\\\n     "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v("border-radius")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("10px"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\\\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token selector"}},[s._v("\\\n    QMenu::item")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\\\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v("font-size")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("10pt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\\\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v("color")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rgb")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\\\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v("background-color")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" transparent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\\\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v("padding")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 8px 25px 6px 10px"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\\\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v("margin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 4px 1px"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\\\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token selector"}},[s._v("\\\n    QMenu::item:selected")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\\\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v("background-color")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" lightblue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\\\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v("border-radius")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("5px"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\\\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token selector"}},[s._v("\\\n    QMenu::icon:checked")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\\\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v("background")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rgb")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("253"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("253"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("254"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\\\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v("position")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" absolute"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\\\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v("top")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 1px"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\\\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v("right")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 1px"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\\\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v("bottom")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 1px"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\\\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v("left")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 1px"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\\\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token selector"}},[s._v("\\\n    QMenu::icon:checked:selected")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\\\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v("background-color")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rgb")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("236"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("236"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("237"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\\\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token selector"}},[s._v("\\\n    QMenu::separator")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\\\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v("height")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 2px"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\\\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v("background")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rgb")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("235"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("235"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("236"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\\\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v("margin-left")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 5px"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\\\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v("margin-right")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 5px"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\\\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v('\\\n"'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br")])]),n("p",[s._v("设置四周圆角，所以需要吧原先的背景透明")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("    // pop menu的基本属性，不加这个menu点其他位置不消失\n    // framelesswindowhint 如果设置圆角需要这个，让他变成无边框， 显示圆角\n    // nodropshawWindowhint 不显示阴影，（在某些平台下）因为默认右侧与下侧有阴影，所以导致右下角不显示圆角\n    setWindowFlags(Qt::Popup | Qt::FramelessWindowHint | Qt::NoDropShadowWindowHint);\n    // 设置背景透明，让四个角只显示圆角，不显示其他黑的部分\n    setAttribute(Qt::WA_TranslucentBackground);\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h2",{attrs:{id:"qgraphicsdropshadoweffect"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#qgraphicsdropshadoweffect"}},[s._v("#")]),s._v(" QGraphicsDropShadowEffect")]),s._v(" "),n("p",[s._v("上面设置了不显示自带阴影，但是还是想要菜单有阴影的，所以理所当然的，想到了无边框窗口的常用方法，使用 QGraphicsDropShadowEffect")]),s._v(" "),n("div",{staticClass:"language-c++ line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('    \n\t// 注意在Qss中留出margin，给阴影显示的空间\n\tQGraphicsDropShadowEffect *shadow = new QGraphicsDropShadowEffect(this);\n    shadow->setOffset(0, 0);\n    shadow->setColor(QColor("#444444"));\n    shadow->setBlurRadius(10);\n    setGraphicsEffect(shadow);\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("但是一般无边框窗口我们是在widget里面嵌套一个子Widget留出margin，这个子widget才是真正的显示窗口，setGraphicsEffect作用于这个子widget。")]),s._v(" "),n("p",[s._v("而上面的写法是直接作用于QMenu的主Widget上了。")]),s._v(" "),n("p",[s._v("所以当窗体重新刷新的时候会报error")]),s._v(" "),n("blockquote",[n("p",[s._v("UpdateLayeredWindowIndirect failed for ptDst=(1367, 153), size=(199x219), dirty=(219x239 -10, -10) (参数错误。)")])]),s._v(" "),n("p",[s._v("大概就是画到了QMenu窗口外面。")]),s._v(" "),n("p",[s._v("虽然看起来没什么大问题，因为程序不会崩溃，菜单与阴影也正常显示。")]),s._v(" "),n("p",[s._v("但是当你把QMenu作为类的成员变量时，选择一个QMenu的Action后，再次唤出菜单时，会发现，你上次的选择作为残影留在了上面。没有刷新。")]),s._v(" "),n("p",[s._v("当然，解法也很简单。")]),s._v(" "),n("p",[s._v("出现上面的的原因是QMenu还是同一个menu，因为error没有正常刷新，所以第二次出来时，会留有第一次操作的残影。")]),s._v(" "),n("p",[s._v("那我们用完就销毁好了。每次用的都是新的Menu，作为一个临时变量使用，选择完就销毁。")]),s._v(" "),n("h2",{attrs:{id:"qpainter"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#qpainter"}},[s._v("#")]),s._v(" QPainter")]),s._v(" "),n("p",[s._v("但是如果还是想要优雅一点。")]),s._v(" "),n("p",[s._v("那么就使用另一种阴影方式，用QPainter画出来")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("#define SHADOW_WIDTH 10\t\t// 阴影边框宽度;\n\nMyShadowWidget::MyShadowWidget(QWidget *parent)\n    : QWidget(parent)\n{\n    \n    this->setWindowFlags(Qt::FramelessWindowHint);\n    this->setAttribute(Qt::WA_TranslucentBackground);\n}\n\nvoid MyShadowWidget::paintEvent(QPaintEvent *event)\n{\n    \n    QPainter painter(this);\n    painter.setRenderHint(QPainter::Antialiasing, true);\n    painter.fillRect(QRect(SHADOW_WIDTH, SHADOW_WIDTH, this->width() - 2 * SHADOW_WIDTH, this->height() - 2 * SHADOW_WIDTH), QBrush(Qt::white));\n\n    QColor color(50, 50, 50, 30);\n    for (int i = 0; i < SHADOW_WIDTH; i++)\n    {\n    \n        color.setAlpha(120 - qSqrt(i) * 40);\n        painter.setPen(color);\n        // 方角阴影边框;\n     //   painter.drawRect(SHADOW_WIDTH - i, SHADOW_WIDTH - i, this->width() - (SHADOW_WIDTH - i) * 2, this->height() - (SHADOW_WIDTH - i) * 2);\n        // 圆角阴影边框;\n        painter.drawRoundedRect(SHADOW_WIDTH - i, SHADOW_WIDTH - i, this->width() - (SHADOW_WIDTH - i) * 2, this->height() - (SHADOW_WIDTH - i) * 2, 4, 4);\n    }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])]),n("p",[s._v("但是这种方式毕竟是画出来的，效率可能不太高，效果也可能没有那么好，但是只是一个QMenu，问题不大")]),s._v(" "),n("h2",{attrs:{id:"图片"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#图片"}},[s._v("#")]),s._v(" 图片")]),s._v(" "),n("p",[s._v("据说还有用阴影图片的方法，但是我没使用过。放个连接")]),s._v(" "),n("p",[s._v("https://www.i4k.xyz/article/GoForwardToStep/99549750")])])}),[],!1,null,null,null);t.default=e.exports}}]);